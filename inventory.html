<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory Manager</title>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* CSS Variables */
      :root {
        /* Colors */
        --color-gray-900: #111827;
        --color-gray-800: #1f2937;
        --color-gray-700: #374151;
        --color-gray-600: #4b5563;
        --color-gray-500: #6b7280;
        --color-gray-400: #9ca3af;
        --color-gray-300: #d1d5db;
        --color-gray-200: #e5e7eb;
        --color-gray-100: #f3f4f6;

        --color-indigo-700: #4338ca;
        --color-indigo-600: #4f46e5;
        --color-indigo-500: #6366f1;

        --color-red-500: #ef4444;
        --color-red-400: #f87171;
        --color-200: #fecaca; /* For drag preview opacity */

        --color-yellow-400: #facc15;
        --color-yellow-500: #eab308;

        --color-green-400: #4ade80;
        --color-green-500: #22c55e;

        --color-purple-600: #9333ea;
        --color-purple-700: #7e22ce;

        --color-teal-600: #0d9488;
        --color-teal-700: #0f766e;

        --color-blue-800: #1e40af;

        /* Spacing */
        --spacing-1: 0.25rem; /* 4px */
        --spacing-2: 0.5rem; /* 8px */
        --spacing-3: 0.75rem; /* 12px */
        --spacing-4: 1rem; /* 16px */
        --spacing-6: 1.5rem; /* 24px */
        --spacing-8: 2rem; /* 32px */
        --spacing-px: 1px;

        /* Border Radius */
        --border-radius-md: 0.375rem; /* rounded-md */
        --border-radius-lg: 0.5rem; /* rounded-lg */
        --border-radius-full: 9999px; /* rounded-full */

        /* Font Sizes */
        --font-size-xs: 0.75rem; /* 12px */
        --font-size-sm: 0.875rem; /* 14px */
        --font-size-base: 1rem; /* 16px */
        --font-size-md: 1.125rem; /* 18px */
        --font-size-lg: 1.25rem; /* 20px */
        --font-size-xl: 1.25rem; /* 20px */
        --font-size-2xl: 1.5rem; /* 24px */
        --font-size-3xl: 1.875rem; /* 30px */
        --font-size-4xl: 2.25rem; /* 36px */

        /* Box Shadow */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);

        /* Transitions */
        --transition-duration-fast: 0.1s;
        --transition-duration-normal: 0.2s;
        --transition-duration-slow: 0.3s;
        --transition-timing-ease-out: ease-out;
        --transition-timing-ease-in-out: ease-in-out;
        --transition-timing-ease: ease;

        /* Other */
        --border-width-1px: 1px;
        --border-width-2px: 2px;
        --border-width-4px: 4px;
        --opacity-0: 0;
        --opacity-50: 0.5;
        --opacity-75: 0.75;
        --opacity-100: 1;
        --z-index-10: 10;
        --z-index-20: 20;
        --z-index-50: 50;
        --z-index-100: 100; /* Added for tooltip */
        --grid-cell-size: 15px; /* Changed for 20x20 editor */
      }

      body {
        font-family: "Inter", sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-smoothing: grayscale;
      }
      .hide-scrollbar {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
      .hide-scrollbar::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
      }
      .shape-editor-grid {
        display: grid;
        /* Updated for 20x20 grid */
        grid-template-columns: repeat(20, 1fr);
        grid-template-rows: repeat(20, 1fr);
        width: calc(
          20 * var(--grid-cell-size)
        ); /* 20 cells * 10px/cell = 200px */
        height: calc(20 * var(--grid-cell-size));
        border: var(--border-width-1px) solid var(--color-gray-600);
        background-color: var(--color-gray-700);
        margin-bottom: var(--spacing-2);
      }
      .shape-editor-cell {
        width: var(--grid-cell-size);
        height: var(--grid-cell-size);
        border: var(--border-width-1px) solid var(--color-gray-600);
        background-color: var(--color-gray-600);
        cursor: pointer;
      }
      .shape-editor-cell.active {
        background-color: var(--color-indigo-500);
      }
      .item-shape-cell {
        border: 1px solid rgba(0, 0, 0, 0.2);
        box-sizing: border-box;
      }
      /* Removed backpack-border-transition as it's no longer needed */

      /* Custom animations and transitions */
      .form-collapse-transition {
        transition: max-height var(--transition-duration-slow)
            var(--transition-timing-ease-out),
          opacity var(--transition-duration-slow)
            var(--transition-timing-ease-out),
          padding var(--transition-duration-slow)
            var(--transition-timing-ease-out),
          margin var(--transition-duration-slow)
            var(--transition-timing-ease-out),
          border var(--transition-duration-slow)
            var(--transition-timing-ease-out);
        overflow: hidden;
      }
      .form-collapse-transition.collapsed {
        max-height: 0;
        opacity: var(--opacity-0);
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
        border-width: 0;
      }
      .collapse-icon {
        transition: transform var(--transition-duration-slow)
          var(--transition-timing-ease-out);
      }
      .collapse-icon.rotated {
        transform: rotate(180deg);
      }

      .item-enter-active {
        animation: fadeIn var(--transition-duration-slow)
          var(--transition-timing-ease-out);
      }
      .item-leave-active {
        animation: fadeOut var(--transition-duration-slow)
          var(--transition-timing-ease-out);
      }

      @keyframes fadeIn {
        from {
          opacity: var(--opacity-0);
          transform: translateY(10px);
        }
        to {
          opacity: var(--opacity-100);
          transform: translateY(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: var(--opacity-100);
          transform: translateY(0);
        }
        to {
          opacity: var(--opacity-0);
          transform: translateY(10px);
        }
      }

      /* Updated Modal Styles */
      .modal {
        transition: opacity var(--transition-duration-slow)
          var(--transition-timing-ease);
        opacity: var(--opacity-0);
        pointer-events: none; /* Prevent clicks when hidden/transparent */
      }
      .modal.is-visible {
        opacity: var(--opacity-100);
        pointer-events: auto; /* Allow clicks when visible */
      }

      .modal > div {
        transition: transform var(--transition-duration-slow)
          var(--transition-timing-ease-out);
        transform: scale(0.95);
      }

      .modal.is-visible > div {
        transform: scale(1);
      }

      .alert-fade-enter-active,
      .alert-fade-leave-active {
        transition: opacity var(--transition-duration-slow)
            var(--transition-timing-ease-in-out),
          transform var(--transition-duration-slow)
            var(--transition-timing-ease-in-out);
      }
      .alert-fade-enter,
      .alert-fade-leave-to {
        opacity: var(--opacity-0);
        transform: translate(-50%, 20px);
      }

      /* Tooltip styles */
      #item-tooltip {
        position: absolute;
        background-color: var(--color-gray-700);
        color: var(--color-gray-200);
        padding: var(--spacing-2) var(--spacing-3);
        border-radius: var(--border-radius-md);
        font-size: var(--font-size-sm);
        pointer-events: none;
        opacity: var(--opacity-0);
        transition: opacity var(--transition-duration-normal)
          var(--transition-timing-ease-in-out);
        z-index: var(--z-index-100); /* Changed z-index */
        box-shadow: var(--shadow-md);
        max-width: 400px;
        white-space: normal;
        word-wrap: break-word;
      }
      #item-tooltip p {
        margin-bottom: 0.5rem;
      }
      #item-tooltip.visible {
        opacity: var(--opacity-100);
      }

      /* Left Pane Collapse Styles */
      #left-pane {
        transition: all var(--transition-duration-slow)
          var(--transition-timing-ease-out);
        /* Initial state for mobile */
        width: 100%;
        max-width: 100%;
        flex-shrink: 1;
      }

      @media (min-width: 1024px) {
        /* lg breakpoint */
        #left-pane {
          width: 50%; /* Default width for desktop */
          max-width: 50%; /* Control max width */
        }
      }

      #left-pane.collapsed {
        width: 0 !important;
        max-width: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        opacity: var(--opacity-0);
        overflow: hidden;
        margin-right: 0 !important; /* Remove gap */
        flex-basis: 0 !important; /* Ensure it completely collapses in flex layout */
        min-width: 0 !important; /* Allow to shrink completely */
      }

      /* Context Menu Styles */
      #item-context-menu {
        position: absolute;
        background-color: var(--color-gray-700);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow-lg);
        padding: var(--spacing-1);
        z-index: 1000; /* Higher than tooltip */
        display: none; /* Hidden by default */
        flex-direction: column;
        gap: var(--spacing-1);
      }

      #item-context-menu button {
        width: 100%;
        text-align: left;
        padding: var(--spacing-2) var(--spacing-3);
        border-radius: var(--border-radius-sm);
        color: var(--color-gray-200);
        font-size: var(--font-size-sm);
        transition: background-color var(--transition-duration-fast) ease;
      }

      #item-context-menu button:hover {
        background-color: var(--color-gray-600);
      }

      #item-context-menu button.delete-btn:hover {
        background-color: var(--color-red-700);
        color: white;
      }

      /* Loading Spinner */
      .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #fff;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Visual Polish Styles */
      .btn {
        padding-top: 0.5rem; /* py-2 */
        padding-bottom: 0.5rem;
        padding-left: 1rem; /* px-4 */
        padding-right: 1rem;
        border-radius: 0.375rem; /* rounded-md */
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
        transition-property: all;
        transition-duration: 200ms;
        outline: none;
      }
      .btn-primary {
        background-color: #4f46e5; /* Tailwind bg-indigo-600 */
        color: #fff; /* Tailwind text-white */
      }
      .btn-primary:hover {
        background-color: #4338ca; /* Tailwind hover:bg-indigo-700 */
      }
      .btn-primary:focus {
        outline: 2px solid #6366f1; /* Tailwind focus:ring-indigo-500 */
        outline-offset: 2px;
      }
      .btn-danger {
        background-color: #dc2626; /* Tailwind bg-red-600 */
        color: #fff; /* Tailwind text-white */
      }
      .btn-danger:hover {
        background-color: #b91c1c; /* Tailwind hover:bg-red-700 */
      }
      .btn-danger:focus {
        outline: 2px solid #ef4444; /* Tailwind focus:ring-red-500 */
        outline-offset: 2px;
      }
      .btn-secondary {
        background-color: #4b5563; /* Tailwind bg-gray-600 */
        color: #e5e7eb; /* Tailwind text-gray-200 */
      }
      .btn-secondary:hover {
        background-color: #374151; /* Tailwind hover:bg-gray-700 */
      }
      .btn-secondary:focus {
        outline: 2px solid #6b7280; /* Tailwind focus:ring-gray-500 */
        outline-offset: 2px;
      }
      .item-shape-cell {
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.3;
          transform: scale(1.05);
        }
      }

      .item-pulsate .item-shape-cell {
        animation: pulse 1.2s infinite ease-in-out;
      }

      /* Backpack Themes */
      .theme-leather {
        background-color: #8b4513;
        border-color: #5a2d0c;
        background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%239C92AC" fill-opacity="0.1"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
      }
      .theme-leather > div {
        border-color: rgba(0, 0, 0, 0.2);
      }
      .theme-elvenwood {
        background-color: #228b22;
        border-color: #006400;
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cg fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.1"%3E%3Cpath opacity=".5" d="M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z"/%3E%3Cpath d="M6 5V0H5v5H0v1h5v94h1V6h94V5H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
      }
      .theme-elvenwood > div {
        border-color: rgba(200, 255, 200, 0.2);
      }
      .theme-dwarven-iron {
        background-color: #464646;
        border-color: #1a1a1a;
        background-image: url('data:image/svg+xml,%3Csvg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.1"%3E%3Cpath d="M50 50c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c-5.523 0-10-4.477-10-10zm10 2c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2zM30 30c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c-5.523 0-10-4.477-10-10zm10 2c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2zM10 10c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c-5.523 0-10-4.477-10-10zm10 2c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2z" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
      }
      .theme-dwarven-iron > div {
        border-color: rgba(255, 255, 255, 0.1);
      }
      .outline-white {
        outline: 3px solid rgb(75 85 99 / var(--tw-border-opacity, 1));
        outline-offset: 1px;
      }
      .outline-red {
        outline: 3px solid var(--color-red-500);
        outline-offset: 1px;
      }
      .outline-yellow {
        outline: 3px solid var(--color-yellow-500);
        outline-offset: 1px;
      }
      .outline-green {
        outline: 3px solid var(--color-green-500);
        outline-offset: 1px;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-100">
    <div
      id="app-root"
      class="min-h-screen bg-gray-900 p-8 flex flex-col items-center"
    >
      <h1
        class="text-4xl font-bold text-gray-100 mb-8 rounded-lg p-3 bg-gray-800 shadow-lg"
      >
        Inventory Manager
      </h1>

      <!-- Toggle Left Pane Button -->
      <button
        id="toggle-left-pane-main-btn"
        class="fixed top-1/2 left-0 -translate-y-1/2 bg-indigo-600 text-white p-2 rounded-r-lg shadow-lg z-50 hover:bg-indigo-700 focus:outline-none transition-colors duration-200"
        aria-label="Toggle Left Pane"
      >
        <svg
          class="w-6 h-6 transform rotate-0 transition-transform duration-300"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
          ></path>
        </svg>
      </button>

      <div
        id="main-content-flex-container"
        class="flex flex-col lg:flex-row gap-8 w-full max-w-7xl"
      >
        <!-- Item Creation and List Section (Left Pane) -->
        <div
          id="left-pane"
          class="bg-gray-800 p-6 rounded-lg shadow-2xl flex flex-col"
        >
          <h2
            class="text-2xl font-semibold text-gray-200 mb-4 flex items-center justify-between"
          >
            Create New Item
            <button
              id="toggle-creator-btn"
              class="text-gray-400 hover:text-gray-200 focus:outline-none transition-colors duration-200"
            >
              <svg
                class="w-6 h-6 collapse-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                ></path>
              </svg>
            </button>
          </h2>
          <form
            id="item-creator-form"
            class="mb-6 p-4 border border-gray-700 rounded-lg bg-gray-700 shadow-inner form-collapse-transition collapsed"
          >
            <div class="mb-3">
              <label
                for="itemName"
                class="block text-sm font-medium text-gray-300 mb-1"
                >Item Name</label
              >
              <input
                type="text"
                id="itemName"
                class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
                placeholder="e.g., Health Potion"
                required
              />
            </div>
            <div class="mb-3">
              <label
                for="itemDescription"
                class="block text-sm font-medium text-gray-300 mb-1"
                >Description</label
              >
              <textarea
                id="itemDescription"
                rows="3"
                class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
                placeholder="A brief description of the item."
              ></textarea>
            </div>
            <div class="mb-3">
              <label
                for="itemBaseWeight"
                class="block text-sm font-medium text-gray-300 mb-1"
                >Calculated Weight (from shape)</label
              >
              <input
                type="number"
                id="itemBaseWeight"
                min="0"
                step="0.1"
                value="0"
                readonly
                class="mt-1 block w-full p-2 border border-gray-60-0 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 cursor-not-allowed"
              />
            </div>
            <div class="mb-3">
              <label class="block text-sm font-medium text-gray-300 mb-1"
                >Price</label
              >
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                <div>
                  <label
                    for="itemPriceCP"
                    class="block text-xs font-medium text-gray-400"
                    >CP</label
                  >
                  <input
                    type="number"
                    id="itemPriceCP"
                    min="0"
                    value="0"
                    class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
                  />
                </div>
                <div>
                  <label
                    for="itemPriceSP"
                    class="block text-xs font-medium text-gray-400"
                    >SP</label
                  >
                  <input
                    type="number"
                    id="itemPriceSP"
                    min="0"
                    value="0"
                    class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
                  />
                </div>
                <div>
                  <label
                    for="itemPriceGP"
                    class="block text-xs font-medium text-gray-400"
                    >GP</label
                  >
                  <input
                    type="number"
                    id="itemPriceGP"
                    min="0"
                    value="0"
                    class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
                  />
                </div>
                <div>
                  <label
                    for="itemPricePP"
                    class="block text-xs font-medium text-gray-400"
                    >PP</label
                  >
                  <input
                    type="number"
                    id="itemPricePP"
                    min="0"
                    value="0"
                    class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
                  />
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label class="block text-sm font-medium text-gray-300 mb-1"
                >Item Shape (20x20)</label
              >
              <div id="shape-editor" class="shape-editor-grid">
                <!-- Shape editor cells will be rendered here by JS -->
              </div>
              <div class="flex gap-2 mt-2">
                <button
                  type="button"
                  id="clearShapeBtn"
                  class="flex-1 bg-gray-700 text-gray-300 py-1 px-2 rounded-md text-sm hover:bg-gray-600"
                >
                  Clear
                </button>
                <button
                  type="button"
                  id="fillShapeBtn"
                  class="flex-1 bg-gray-700 text-gray-300 py-1 px-2 rounded-md text-sm hover:bg-gray-600"
                >
                  Fill
                </button>
              </div>
            </div>
            <button type="submit" class="w-full btn btn-primary">
              Add Item
            </button>
          </form>

          <h2 class="text-2xl font-semibold text-gray-200 mt-8 mb-4">
            Available Items
          </h2>

          <!-- Search and Filter Controls -->
          <div class="mb-4 flex flex-col sm:flex-row gap-4">
            <input
              type="text"
              id="itemSearchInput"
              placeholder="Search items..."
              class="flex-1 p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
            />
            <select
              id="itemCategoryFilter"
              class="p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
            >
              <option value="All">All Categories</option>
              <!-- Categories will be populated by JS -->
            </select>
          </div>

          <div
            id="available-items-list"
            class="flex flex-col gap-4 overflow-y-auto max-h-[800px] hide-scrollbar p-4 rounded-lg bg-gray-700"
          >
            <!-- Available items will be rendered here by JS -->
          </div>
        </div>

        <!-- Backpack Section -->
        <div
          class="flex-1 bg-gray-800 p-6 rounded-lg shadow-2xl flex flex-col items-center"
        >
          <h2
            id="current-backpack-name"
            class="text-2xl font-semibold text-gray-200 mb-4"
          >
            Backpack
          </h2>

          <div class="text-lg font-medium text-gray-400 mb-2">
            Total Weight:
            <span id="total-weight" class="font-bold text-indigo-400"
              >0 lbs</span
            >
            / <span id="max-weight">0</span> lbs
          </div>
          <div
            id="encumbrance-status"
            class="text-md font-medium mb-2 text-green-400"
          >
            Status: Normal
          </div>
          <!-- Moved encumbrance labels here -->
          <div
            class="flex flex-wrap justify-center gap-4 text-xs text-gray-400 w-full mb-4"
          >
            <div class="flex flex-col items-center">
              <span class="font-semibold">Normal</span>
              <span class="text-gray-500"
                >(0 - <span id="normal-threshold"></span> lbs)</span
              >
            </div>
            <div class="flex flex-col items-center">
              <span class="font-semibold">Encumbered</span>
              <span class="text-gray-500"
                >(<span id="encumbered-threshold-start"></span> -
                <span id="encumbered-threshold-end"></span> lbs)</span
              >
            </div>
            <div class="flex flex-col items-center">
              <span class="font-semibold">Heavily Encumbered</span>
              <span class="text-gray-500"
                >(<span id="heavily-encumbered-threshold-start"></span> -
                <span id="heavily-encumbered-threshold-end"></span> lbs)</span
              >
            </div>
          </div>
          <!-- Backpack -->
          <div class="grid grid-cols-3 gap-4 w-full">
            <div
              id="backpack-grid-container"
              class="col-span-2 relative border-gray-600 bg-gray-800 rounded-lg overflow-hidden w-full aspect-square outline-offset-2 outline-2 outline-solid"
            >
              <!-- Grid cells and placed items will be rendered here by JS -->
              <!-- Dedicated drag preview element -->
              <div
                id="drag-preview"
                class="absolute rounded-md border-2 opacity-50 z-20 hidden pointer-events-none"
              >
                <!-- Item shape will be rendered here dynamically -->
              </div>
            </div>
            <div
              id="placed-items-list-container"
              class="col-span-1 bg-gray-700 p-4 rounded-lg overflow-y-auto"
            >
              <h3
                class="text-lg font-semibold mb-2 border-b border-gray-600 pb-2"
              >
                Items in Backpack
              </h3>
              <ul id="placed-items-list" class="space-y-2">
                <!-- List items will be rendered here -->
              </ul>
            </div>
          </div>

          <!-- Currency -->
          <div class="mt-6 p-4 border border-gray-600 rounded-lg">
            <h4 class="font-semibold text-gray-300 mb-3">Currency</h4>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
              <div>
                <label
                  for="copperPieces"
                  class="block text-sm font-medium text-gray-300 mb-1"
                  >CP</label
                >
                <input
                  type="number"
                  id="copperPieces"
                  min="0"
                  class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                />
              </div>
              <div>
                <label
                  for="silverPieces"
                  class="block text-sm font-medium text-gray-300 mb-1"
                  >SP</label
                >
                <input
                  type="number"
                  id="silverPieces"
                  min="0"
                  class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                />
              </div>
              <div>
                <label
                  for="goldPieces"
                  class="block text-sm font-medium text-gray-300 mb-1"
                  >GP</label
                >
                <input
                  type="number"
                  id="goldPieces"
                  min="0"
                  class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                />
              </div>
              <div>
                <label
                  for="platinumPieces"
                  class="block text-sm font-medium text-gray-300 mb-1"
                  >PP</label
                >
                <input
                  type="number"
                  id="platinumPieces"
                  min="0"
                  class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                />
              </div>
            </div>
          </div>

          <!-- Backpack Settings (Collapsible) -->
          <div class="mt-6 w-full mb-6 bg-gray-700 rounded-lg p-4 shadow-inner">
            <h3
              class="text-xl font-semibold text-gray-200 flex justify-between items-center cursor-pointer"
              id="toggle-settings-header"
            >
              <span>Backpack Settings</span>
              <svg
                class="w-6 h-6 collapse-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                ></path>
              </svg>
            </h3>
            <div
              id="all-settings-content"
              class="form-collapse-transition collapsed space-y-4"
            >
              <!-- Manage Current Backpack -->
              <div class="p-4 mt-4 border border-gray-600 rounded-lg">
                <h4 class="font-semibold text-gray-300 mb-3">
                  Manage Current Backpack
                </h4>
                <div class="mb-3">
                  <label
                    for="backpackSelector"
                    class="block text-sm font-medium text-gray-300 mb-1"
                    >Select Backpack:</label
                  >
                  <select
                    id="backpackSelector"
                    class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                  ></select>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <button
                    id="renameBackpackBtn"
                    class="btn bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-indigo-500"
                  >
                    Rename
                  </button>
                  <button
                    id="clearBackpackBtn"
                    class="btn bg-yellow-500 text-white hover:bg-yellow-600 focus:ring-yellow-500"
                  >
                    Clear
                  </button>
                  <button id="deleteCurrentBackpackBtn" class="btn btn-danger">
                    Delete
                  </button>
                </div>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label
                      for="currentStrengthScore"
                      class="block text-sm font-medium text-gray-300 mb-1"
                      >Strength Score</label
                    >
                    <select
                      id="currentStrengthScore"
                      class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                    ></select>
                  </div>
                  <div>
                    <label
                      for="currentCreatureSize"
                      class="block text-sm font-medium text-gray-300 mb-1"
                      >Creature Size</label
                    >
                    <select
                      id="currentCreatureSize"
                      class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                    ></select>
                  </div>
                </div>
                <div class="mt-4">
                  <label
                    for="backpackThemeSelector"
                    class="block text-sm font-medium text-gray-300 mb-1"
                    >Backpack Theme</label
                  >
                  <select
                    id="backpackThemeSelector"
                    class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-800 text-gray-100"
                  >
                    <option value="default">Default</option>
                    <option value="theme-leather">Classic Leather</option>
                    <option value="theme-elvenwood">Elvenwood</option>
                    <option value="theme-dwarven-iron">Dwarven Iron</option>
                  </select>
                </div>
              </div>

              <!-- Create New Backpack Section (NEW) -->
              <div class="mt-6 p-4 border border-gray-600 rounded-lg">
                <h4 class="font-semibold text-gray-300 mb-3">
                  Create New Backpack
                </h4>
                <form
                  id="backpack-creator-form"
                  class="border border-gray-700 rounded-lg bg-gray-700 shadow-inner form-collapse-transition"
                >
                  <div class="mb-3">
                    <label
                      for="newBackpackName"
                      class="block text-sm font-medium text-gray-300 mb-1"
                      >Backpack Name</label
                    >
                    <input
                      type="text"
                      id="newBackpackName"
                      class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
                      placeholder="e.g., Adventurer's Pack"
                      required
                    />
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label
                        for="newBackpackStrength"
                        class="block text-sm font-medium text-gray-300 mb-1"
                        >Strength Score</label
                      >
                      <select
                        id="newBackpackStrength"
                        class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
                      >
                        <!-- Options will be rendered here by JS -->
                      </select>
                    </div>
                    <div>
                      <label
                        for="newBackpackSize"
                        class="block text-sm font-medium text-gray-300 mb-1"
                        >Creature Size</label
                      >
                      <select
                        id="newBackpackSize"
                        class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
                      >
                        <!-- Options will be rendered here by JS -->
                      </select>
                    </div>
                  </div>
                  <button type="submit" class="w-full btn btn-primary">
                    Create Backpack
                  </button>
                </form>
              </div>

              <!-- Import/Export -->
              <div class="p-4 border border-gray-600 rounded-lg">
                <h4 class="font-semibold text-gray-300 mb-3">
                  Import / Export JSON Backpacks
                </h4>
                <div class="flex gap-4">
                  <button
                    id="exportBtn"
                    class="btn bg-purple-600 text-white hover:bg-purple-700 focus:ring-purple-500"
                  >
                    Export Backpack
                  </button>
                  <button
                    id="importBtn"
                    class="btn bg-teal-600 text-white hover:bg-teal-700 focus:ring-teal-500"
                  >
                    Import Backpack
                  </button>
                </div>
              </div>
              <!-- Google Sheet Integration -->
              <div class="p-4 border border-gray-600 rounded-lg">
                <h4 class="font-semibold text-gray-300 mb-3">
                  Available items
                </h4>
                <div class="flex gap-4">
                  <button
                    id="saveToSheetBtn"
                    class="flex-1 btn bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 flex items-center justify-center"
                  >
                    <span id="saveToSheetBtnText">Export to Sheet</span>
                    <div
                      id="saveToSheetLoading"
                      class="loading-spinner ml-2 hidden"
                    ></div>
                  </button>
                  <button
                    id="loadFromSheetBtn"
                    class="flex-1 btn bg-green-600 text-white hover:bg-green-700 focus:ring-green-500 flex items-center justify-center"
                  >
                    <span id="loadFromSheetBtnText">Import from Sheet</span>
                    <div
                      id="loadFromSheetLoading"
                      class="loading-spinner ml-2 hidden"
                    ></div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Export Modal -->
      <div
        id="exportModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 hidden modal"
      >
        <div class="bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-lg">
          <h3 class="text-xl font-semibold text-gray-200 mb-4">
            Export Backpack Data
          </h3>
          <p class="text-gray-300 mb-4">
            Copy the JSON below to save your backpack configuration:
          </p>
          <textarea
            id="export-data-textarea"
            readonly
            class="w-full h-48 p-3 border border-gray-600 rounded-md bg-gray-700 font-mono text-sm resize-none text-gray-100"
          ></textarea>
          <div class="mt-4 flex justify-end">
            <button id="closeExportModalBtn" class="btn btn-secondary">
              Close
            </button>
          </div>
        </div>
      </div>

      <!-- Import Modal -->
      <div
        id="importModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 hidden modal"
      >
        <div class="bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-lg">
          <h3 class="text-xl font-semibold text-gray-200 mb-4">
            Import Backpack Data
          </h3>
          <p class="text-gray-300 mb-4">Paste your exported JSON data below:</p>
          <textarea
            id="import-data-textarea"
            class="w-full h-48 p-3 border border-gray-600 rounded-md bg-gray-700 font-mono text-sm resize-none text-gray-100"
            placeholder='Paste JSON data here, e.g., {"availableItems": [...], "placedItems": [...]}'
          ></textarea>
          <div class="mt-4 flex justify-end gap-3">
            <button id="cancelImportModalBtn" class="btn btn-secondary">
              Cancel
            </button>
            <button
              id="confirmImportBtn"
              class="btn bg-teal-600 text-white hover:bg-teal-700 focus:ring-teal-500"
            >
              Import
            </button>
          </div>
        </div>
      </div>

      <!-- Custom Alert Message Box -->
      <div
        id="alertMessageBox"
        class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-blue-800 text-white px-6 py-3 rounded-lg shadow-xl text-center z-50 hidden alert-fade-enter"
      >
        <p id="alertMessageText"></p>
      </div>

      <!-- Item Tooltip -->
      <div id="item-tooltip" class="hidden"></div>

      <!-- Item Context Menu -->
      <div id="item-context-menu" class="hidden">
        <button id="context-delete-btn" class="delete-btn">Delete Item</button>
        <button id="context-edit-name-btn">Edit Name</button>
        <button id="context-edit-description-btn">Edit Description</button>
        <button id="context-edit-rotate-btn">
          Rotate item </br> (only works for items inside the backpack)
        </button>
        <button id="context-edit-price-btn">Edit Price</button>
        <button id="context-edit-shape-btn">Edit Shape</button>
        <button id="context-edit-color-btn">Change Color</button>
      </div>

      <!-- Generic Edit Modal -->
      <div
        id="editModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 hidden modal"
      >
        <div class="bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-lg">
          <label
            for="editModalInput"
            class="block text-sm font-medium text-gray-300 mb-1"
            >New Value:</label
          >
          <input
            type="text"
            id="editModalInput"
            class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100"
          />
          <textarea
            id="editModalTextarea"
            rows="4"
            class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 hidden"
          ></textarea>
          <input
            type="color"
            id="editModalColorInput"
            class="mt-1 block w-full h-10 p-1 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 hidden"
          />

          <!-- Price Edit Fields (initially hidden) -->
          <div
            id="editModalPriceFields"
            class="grid grid-cols-2 sm:grid-cols-4 gap-2 mt-3 hidden"
          >
            <h3 id="editModalTitle" class="text-xl font-semibold text-gray-200 mb-4"><!-- Changed in code --></h3>
            <div>
              <label
                for="editPriceCP"
                class="block text-xs font-medium text-gray-400"
                >CP</label
              >
              <input
                type="number"
                id="editPriceCP"
                min="0"
                value="0"
                class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
              />
            </div>
            <div>
              <label
                for="editPriceSP"
                class="block text-xs font-medium text-gray-400"
                >SP</label
              >
              <input
                type="number"
                id="editPriceSP"
                min="0"
                value="0"
                class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
              />
            </div>
            <div>
              <label
                for="editPriceGP"
                class="block text-xs font-medium text-gray-400"
                >GP</label
              >
              <input
                type="number"
                id="editPriceGP"
                min="0"
                value="0"
                class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
              />
            </div>
            <div>
              <label
                for="editPricePP"
                class="block text-xs font-medium text-gray-400"
                >PP</label
              >
              <input
                type="number"
                id="editPricePP"
                min="0"
                value="0"
                class="mt-1 block w-full p-2 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 text-sm"
              />
            </div>
          </div>

          <div class="mt-4 flex justify-end gap-3">
            <button id="cancelEditModalBtn" class="btn btn-secondary">
              Cancel
            </button>
            <button id="confirmEditModalBtn" class="btn btn-primary">
              Save
            </button>
          </div>
        </div>
      </div>

      <!-- Shape Edit Modal (NEW) -->
      <div
        id="shapeEditModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 hidden modal"
      >
        <div class="bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-lg">
          <h3 class="text-xl font-semibold text-gray-200 mb-4">
            Edit Item Shape
          </h3>
          <div class="mb-3">
            <label class="block text-sm font-medium text-gray-300 mb-1"
              >Current Item Shape (20x20)</label
            >
            <div id="shape-edit-editor" class="shape-editor-grid">
              <!-- Shape editor cells will be rendered here by JS -->
            </div>
            <div class="flex gap-2 mt-2">
              <button
                type="button"
                id="clearShapeEditBtn"
                class="flex-1 bg-gray-700 text-gray-300 py-1 px-2 rounded-md text-sm hover:bg-gray-600"
              >
                Clear
              </button>
              <button
                type="button"
                id="fillShapeEditBtn"
                class="flex-1 bg-gray-700 text-gray-300 py-1 px-2 rounded-md text-sm hover:bg-gray-600"
              >
                Fill
              </button>
            </div>
            <div class="mt-3">
              <label
                for="itemEditBaseWeight"
                class="block text-sm font-medium text-gray-300 mb-1"
                >Calculated Weight (from shape)</label
              >
              <input
                type="number"
                id="itemEditBaseWeight"
                min="0"
                step="0.1"
                value="0"
                readonly
                class="mt-1 block w-full p-2 border border-gray-60-0 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-gray-700 text-gray-100 cursor-not-allowed"
              />
            </div>
          </div>
          <div class="mt-4 flex justify-end gap-3">
            <button id="cancelShapeEditModalBtn" class="btn btn-secondary">
              Cancel
            </button>
            <button id="confirmShapeEditBtn" class="btn btn-primary">
              Save Shape
            </button>
          </div>
        </div>
      </div>

      <!-- Confirmation Modal (NEW) -->
      <div
        id="confirmModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 hidden modal"
      >
        <div class="bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-md">
          <h3
            id="confirmModalTitle"
            class="text-xl font-semibold text-yellow-400 mb-4"
          >
            Confirmation Required
          </h3>
          <p id="confirmModalMessage" class="text-gray-300 mb-6"></p>
          <div class="mt-4 flex justify-end gap-3">
            <button id="cancelConfirmModalBtn" class="btn btn-secondary">
              Cancel
            </button>
            <button id="confirmModalBtn" class="btn btn-danger">Confirm</button>
          </div>
        </div>
      </div>
    </div>
    <script src="src/inventory.js"></script>
  </body>
</html>
